# The installation and usage of BWA-MEM2

# 1. About

Splice-unware. Bwa-mem2 is the next version of the bwa-mem algorithm in bwa. It produces alignment identical to bwa and is ~1.3-3.1x faster depending on the use-case, dataset and the running machine.

# 2. Installation and Usage

## Precompiled binaries

```
curl -L https://github.com/bwa-mem2/bwa-mem2/releases/download/v2.0pre2/bwa-mem2-2.0pre2_x64-linux.tar.bz2 | tar jxf -
```

## Install from conda

```bash
conda install -c bioconda bwa-mem2
```

## 2.1 Build genome index

```bash
bwa-mem2 index -p bwa_index /projects/b1171/qgn1237/1_my_database/GRCh38_p13/GRCh38.p13.genome.fa
```

## 2.2 Running mapping job with BWA-MEM

For paired-end reads, note that the input is not the genome, it's the index instead:

```
bwa-mem2 mem -t 12 -M -Y -R '@RG\tID:SRR7346979\tPL:illumina\tLB:library\tSM:SAMN09428901' /projects/b1171/qgn1237/1_my_database/GRCh38_p13/bwa_index /projects/b1171/qgn1237/2_raw_data/SKBR3/illumina_250_SRR7346979/SRR7346979/SRR7346979_1.fastq /projects/b1171/qgn1237/2_raw_data/SKBR3/illumina_250_SRR7346979/SRR7346979/SRR7346979_2.fastq | samtools sort -@ 12 -m 2G -O BAM -o SKBR3_NGS.bam && samtools index SKBR3_NGS.bam SKBR3_NGS.bai
```

-M	Mark shorter split hits as secondary (for Picard compatibility).
-t INT	Number of threads.
-R STR	Complete read group header line. ’\t’ can be used in STR and will be converted to a TAB in the output SAM. The read group ID will be attached to every read in the output. An example is ’@RG\tID:foo\tSM:bar’.

## 2.3 Output files
BWA outputs the final alignment in the SAM (Sequence Alignment/Map) format. Each line consists of:

Col	Field	Description
1	QNAME	Query (pair) NAME
2	FLAG	bitwise FLAG
3	RNAME	Reference sequence NAME
4	POS	1-based leftmost POSition/coordinate of clipped sequence
5	MAPQ	MAPping Quality (Phred-scaled)
6	CIAGR	extended CIGAR string
7	MRNM	Mate Reference sequence NaMe (‘=’ if same as RNAME)
8	MPOS	1-based Mate POSistion
9	ISIZE	Inferred insert SIZE
10	SEQ	query SEQuence on the same strand as the reference
11	QUAL	query QUALity (ASCII-33 gives the Phred base quality)
12	OPT	variable OPTional fields in the format TAG:VTYPE:VALUE

Each bit in the FLAG field is defined as:

Chr	Flag	Description
p	0x0001	the read is paired in sequencing
P	0x0002	the read is mapped in a proper pair
u	0x0004	the query sequence itself is unmapped
U	0x0008	the mate is unmapped
r	0x0010	strand of the query (1 for reverse)
R	0x0020	strand of the mate
1	0x0040	the read is the first read in a pair
2	0x0080	the read is the second read in a pair
s	0x0100	the alignment is not primary
f	0x0200	QC failure
d	0x0400	optical or PCR duplicate

BWA generates the following optional fields. Tags starting with ‘X’ are specific to BWA.

Tag	Meaning
NM	Edit distance
MD	Mismatching positions/bases
AS	Alignment score
BC	Barcode sequence
X0	Number of best hits
X1	Number of suboptimal hits found by BWA
XN	Number of ambiguous bases in the referenece
XM	Number of mismatches in the alignment
XO	Number of gap opens
XG	Number of gap extentions
XT	Type: Unique/Repeat/N/Mate-sw
XA	Alternative hits; format: (chr,pos,CIGAR,NM;)*
XS	Suboptimal alignment score
XF	Support from forward/reverse alignment
XE	Number of supporting seeds
Note that XO and XG are generated by BWT search while the CIGAR string by Smith-Waterman alignment. These two tags may be inconsistent with the CIGAR string. This is not a bug.

# 3. Citation
Vasimuddin Md, Sanchit Misra, Heng Li, Srinivas Aluru. Efficient Architecture-Aware Acceleration of BWA-MEM for Multicore Systems. IEEE Parallel and Distributed Processing Symposium (IPDPS), 2019.
